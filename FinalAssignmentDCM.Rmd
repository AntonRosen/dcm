---
title: "Final Assignment - DCM"
author: "Anonymous id - 65352"
date: '2021-03-23'
output: pdf_document

---

```{r setup, include=FALSE, echo=FALSE}
# Focal variable = Race and hispanic origin
# State = Kenntucky
# main dependent variable = migrate1 
# st_orgi = origin state for each respondent
# race = Race (general version)
# raced = Race (detailed version)
# hispan = Hispanic origin (general version)
# hispand = Hispanic orgin (detailed version)

knitr::opts_chunk$set(echo = TRUE)
library(ipumsr)
library(labelled)
library(tidyverse)
library(ggplot2)
library(stargazer)
library(effects)
library(kableExtra)
library(lmtest)
Kentucky <- readRDS("Kentucky.rds")
```

```{r, echo=FALSE, include=FALSE}
Kentucky$migrate1 <- na.omit(Kentucky$migrate1)
try(na.fail(Kentucky$migrate1))
```

```{r, echo=FALSE}
Kentucky$migrate.binary <- ifelse(Kentucky$migrate1 %in% c("1"), 0, 1)
```

```{r, echo=FALSE}
Kentucky$race <- factor(Kentucky$race)
Kentucky <- Kentucky %>% mutate(race = fct_recode(race,
           White = "1",
           "African American" = "2",
           "Native American" = "3",
           "East Asian" = "4",
           "East Asian" = "5",
           "Other Asian" = "6", 
           "Other Race" = "7",
           Mixed = "8",
           Mixed = "9"))

Kentucky$hispan <- factor(Kentucky$hispan)
Kentucky <- Kentucky %>% mutate(hispan = fct_recode(hispan,
           "Not Hispanic" = "0",
           Hispanic = "1",
           Hispanic = "2",
           Hispanic = "3",
           Hispanic = "4",))
```


### Task A 

For a large part, migration can be understood as a labor market phenomena where people move in and out of places based on the locales access to jobs (Frey & Liaw, 2005) We can think of "The Grapes of Wrath" and how the main characters move all the way from Oklahoma to California in pursuit of work and economic opportunities. Kentucky's unemployment rate is below the national average and its economy is predominantly centered on manufacturing, trade, mining and agriculture. Historically, Kentucky has been an agricultural based state but the mining and manufacturing sectors has overtaken and nowadays these sectors are the largest contributors to Kentucky's economy. (Encyclopaedia Britannica)

Due to the fact that Kentucky has a relatively low unemployment rate I expect more people, regardless of ethnicity, to stay put than to migrate. 

As outlined above, blue collar work fuels Kentucky's economy. I believe that the implications of this, from a perspective of race and migration, is that racial groups which has a proportionally larger amount of blue-collar workers are the most likely to move. This is because, even though unemployment levels are quite low, I believe there is more uncertainty in terms work stability related to this labor category than compared to for instance white collar work. Given this assumption, I believe racial minority groups will have a greater likelihood to move than whites since I expect them to have larger proportions of blue collar workers. 

__Nullhypothesis 1__: There is no difference in likelihood of migration between the different racial groups.

__Alt.Hypothesis 1__: Racial minorities have a greater likelihood to migrate than whites. 

This is a kind of reductionist perspective in regards to race. Deeper analysis of each racial subgroup could have been applied. However, I am satisfied with this initial framing and hypothesis. 

Post-Hoc note: I combined Japanese and Chinese to one category (East Asian) and I also created a Mixed category, as well as a category for Other Asian. Given the limited amount of data it might have made more sense to combine the racial categories in other ways, for instance I could have combined all Asiatic ethnicities to one Asian category instead of two.


### Task B

```{r, echo=FALSE, fig.heigh=10, fig.width=10}
counts <- proportions(table(Kentucky$migrate.binary, Kentucky$race), margin=2)
barplot(counts, beside = TRUE, main="Migration distribution",
        xlab="Race", ylab="Proportional migration", col=c("darkblue","yellow"), cex.names = 0.5)
opar = par(oma = c(0,0,0,0), mar = c(0,0,0,0), new = TRUE)
legend("topright", legend = rownames(counts), fill=c("darkblue", "yellow"))
```
```{r, echo=FALSE}
counts2 <- proportions(table(Kentucky$migrate.binary, Kentucky$hispan), margin=2)
barplot(counts2, beside = TRUE, main="Migration distribution",
        xlab="Hispanic binary", ylab="Proportional migration", col=c("darkblue","yellow"), cex.names = 0.5)
opar = par(oma = c(0,0,0,0), mar = c(0,0,0,0), new = TRUE)
legend("topright", legend = rownames(counts2), fill=c("darkblue", "yellow"))
```

The visualizations show the proportional migration behavior in Kentucky for each ethnic group under investigation in this assignment. 1s indicate migration, 0s non-migration. We clearly see that people tend to stay put more than they migrate across all ethnic groups. Tabulation does not reveal any separation problems.

\newpage

### Task C & E


```{r, echo=FALSE, include=FALSE}
m1 <- glm(formula = migrate.binary ~ race + hispan, family=binomial(link="logit"), data = Kentucky)
summary(m1)
```

```{r, echo=FALSE}
Kentucky$citizen <- factor(Kentucky$citizen)
Kentucky <- Kentucky %>% mutate(citizen = fct_recode(citizen,
           "Not Available" = "0",
           "Born Abroad" = "1",
           "Naturalized Citizen" = "2",
           "Not Citizen" = "3",
           ))
```

```{r, echo=FALSE}
Kentucky$hhincome_bi <- ifelse(Kentucky$hhincome < 0,0,1)
Kentucky$hhincome <- ifelse(Kentucky$hhincome < 0, 0, Kentucky$hhincome)
Kentucky$hhincome <- ifelse(Kentucky$hhincome == 0, 1, Kentucky$hhincome)
```


```{r, echo=FALSE, include=FALSE}
m2 <- glm(formula = migrate.binary ~ race + hispan + log(hhincome) + hhincome_bi + citizen, family=binomial(link="logit"), data = Kentucky)
summary(m2)
```

```{r, echo=FALSE, results= 'asis'}
stargazer(list(m1, m2),
          header=F, keep.stat = c("n","ll"),
          title = "Generalized linear model - Migration by Race and Hispanic origin",
          notes = c("Source: IPUMS Kentucky"),
          font.size = "footnotesize",
          covariate.labels = c("African American", "Native American", "East Asian", "Other Asian", "Other Race", "Mixed", "Hispanic", "Log Household Income", "Binary Household Income", "Born Abroad Citizen", "Naturalized Citizen", "Not Citizen"))
```
\newpage

### Task D

As mentioned in my initial hypothesis, I expect labor category and the circumstances surrounding job security to serve as a potential mediator of the effect of race. I believe the household income variable, `hhincome`, can serve as a proxy as to what labor category an individual either belongs to or is associated with through family ties. Including this covariate in the model is important because I believe it helps us control this notion. However, there are problems with this assumption. For instance, Kentucky is to a large part a republican state which means, I believe, that they have quite relaxed tax laws. There could thus be cases where very well-off individuals report household income which is far from the reality of things due to certain tax exemptions. I include both a binary variable for household income, controlling likelihoods for people with negative income and positive income. I also add the logarithm of household income in order to normalize and avoid problems with potential outliers. 


Another important control that I believe we should include relates to U.S citizenship and is captured by the `citizen` variable. When looking at the likelihoods for different races to migrate, I think that the effect of race might be moderated by ones immigration status. I believe being an immigrant could increase oneÂ´s likelihood to migrate because 1. The respondent has already migrated before, and 2. The respondent might not be as "rooted", i.e have family ties etc. to the places they reside. Potentially, it also captures aspects of employment opportunities. For instance we know that there are a lot of individuals, predominantly of hispanic origin, that resides as illegal immigrants in USA. These people do not have the same opportunities on the labor market as U.S citizens, so in a way this covariate might capture the mediating effects that informal employment opportunity among certain ethnic groups have as well. Conversely, illegal immigrants might also prefer to remain in same place for longer periods in order not to draw attention to their legal status.(Gurak & Kritz, 2000)

\newpage

### Task F

```{r, echo=FALSE, fig.width=20, fig.height=10}
preds_m1 <- plot(allEffects(m1))
preds_m1
```

```{r, echo=FALSE, fig.width=30, fig.height=10, fig.asp=0.5}
preds_m2 <- plot(allEffects(m2))
```
\newpage

### Task G

```{r, echo=FALSE, include=FALSE}
(lrtest(m1,m2))
```


```{r, echo=FALSE}
a <- exp(coef(m1))

knitr::kable((a), col.names = "Odds ratios", digits=3, caption = "Generalized linear model 1")
```

```{r, echo=FALSE}
b <- exp(coef(m2))

knitr::kable((b), col.names = "Odds ratios", digits=3, caption = "Generalized linear model 2")
```

In the first model, all estimates except for Native American and Other Race are significant. Computing `table(Kentucky$race)` shows that we have 73 Native American individuals and 203 Other Race individuals in the data. These are quite small samples looked at from the totality of individuals in our data so it is not surprising that the estimates for this groups had potential to return insignificant estimates. However, it is interesting to see that the East Asian subgroup, with only 141 individuals, returned an estimate with such high significance. 

I transform the log-odds estimates from my models to odds ratios which are displayed in the tables above. 

The odds of white person migrating is represented by the constants(intercepts). We see that the odds of a white person migrating in relation to the reference category, which is white people living in the same house (non-migrants), is lower than 1 in both models. This tell us that the likelihood of a white person moving is smaller than it is for white people staying (not migrating). 

I believe the reference category is normalized to 1 so we constantly compare the estimate in relation to this and check if it is smaller or larger than 1 to determine odds of migration.

We can see that the likelihood of white people migrating diminishes when controls are added which is what we expect when partial mediation is accounted for through the added covariates. 

Moving on to African American, East Asian, Mixed and Hispanic race categories. We see that all of their estimates, when exponentiated to odds ratios, are above 1 which indicate that these racial groups have higher odds of migrating than the reference category (in the case of hispanics: white non-hispanic respondents). For example, in our first model the likelihood of a hispanic person migrating is ~1.8. So the likelihood to move is .8 higher for this group than it is for white non-hispanic respondents.

We see that the extra covariates account for partial mediation over these racial groups as well because their estimates also diminish from the first to the second model. Significant covariates in the second model are log household income, being born abroad and not being a citizen. Some of the added covariates are insignificant. So even though we know that the new covariates partially mediate the effect of race we don't know the effect of each covariate individually which makes it hard to discern the exact effect these have. I believe this could be approximated if we added each covariate one at a time to the model and linear hypothesis test them. 

Looking at my results, I believe my hypothesis is mostly confirmed although we lack significance for some groups. Given that the estimate is significant, a racial minority will have higher likelihood to migrate than whites. However, it is hard to discern whether the specific mechanism behind this is labor market job securities and economic opportunities. 

Likelihood Ratio testing the models show that model 2 has a significantly higher test statistic, indicating that model 2 is the more useful model so I believe we do have some indication that the outlined mechanism have some validity here. 

\newpage

## Problem 2

### Task A

Im going to work with the `migrate1` variable for the rest of this problem. I expect that my focal independent variables will have different relationships to the different categories of the outcome.
Based on what we saw in Problem 1, most respondents fall into the outcome category $Y{SameHouse}$, which indicate non-migration.

I expect that migration within Kentucky will be most prevalent among larger racial minorities. So based on what we saw in Problem 1, where African American and Hispanic respondents had quite high likelihood for migration, I expect that this is the multinomial outcome that will be most likely for these two groups. To be specific: the estimates for $Y{MovedWithinState}$ will be higher compared to the other outcome for migration in these two racial groups. However, both outcomes will be positive and significant compared to the reference category.

__Nullhypothesis 1__: There is no difference in likelihood between the two migration outcomes for African American and Hispanic respondents.

__Alt.Hypothesis 1__: It is more likely for African American and Hispanic respondents to move within the state of Kentucky then to move across state borders.

In regards to the outcome $Y{MovedBetweenStates}$, given that I believe proportionally more well of groups are more likely to undertake this type of migration because it is a more resource intensive type of migration, I expect whites to undertake this type of migration more compared to the migration outcome of moving within Kentucky. However, I believe the outcome will not reflect greater odds of migration compared to the reference category. 

__Nullhypothesis 2__: There is no difference in likelihood between the two migration outcomes for White respondents.

__Alt.Hypothesis 2__: White respondents are more likely to move to another state then to move within Kentucky, however it is still less likely to move to another state then to stay. 

I believe the East Asian, Other Asian and Mixed racial categories will show positive and significant estimates for both outcomes in the model that excludes controls but insignificant results in the model that include controls. 

__Nullhypothesis 3__: There is no difference for East Asian, Other Asian and Mixed categories estimates in terms of significance across the first-order relationship model and the full model.

__Alt.Hypothesis 3__: Only the first-order relationship model will return positive and significant results for East Asian, Other Asian and Mixed.

I do not expect any change in regards to the racial groups that lacked significance in the models estimated for Problem 1. More specifically: the racial groups with insignificant estimates in Problem 1 will also have insignificant estimates in this problem.


### Task B

```{r, echo=FALSE}
Kentucky$metro.binary <- ifelse(Kentucky$countyicp %in% c("1110", "1170", "370", "590", "470", "670"), 1, 0)
```

```{r, echo=FALSE}
Kentucky$migrate1 <- as.factor(Kentucky$migrate1)
Kentucky <- Kentucky %>% mutate(migrate1 = fct_recode(migrate1,
           "Same House" = "1",
           "Moved Within State" = "2",
           "Moved Between State" = "3",
           ))
```

```{r, echo=FALSE, fig.width=10}
counts3 <- proportions(table(Kentucky$migrate1, Kentucky$race), margin=2)

barplot(counts3, beside = TRUE, main="Migration distribution",
        xlab="Race", ylab="Proportions", col=c("darkblue","yellow","green"), cex.names = 0.5)
opar = par(oma = c(0,0,0,0), mar = c(0,0,0,0), new = TRUE)
legend(x=20, y=1, legend = rownames(counts3), fill=c("darkblue", "yellow", "green"))
```


```{r, echo=FALSE, fig.width=10}
counts4 <- proportions(table(Kentucky$migrate1, Kentucky$hispan), margin=2)

barplot(counts4, beside = TRUE, main="Migration distribution",
        xlab="Hispanic binary", ylab="Proportions", col=c("darkblue","yellow","green"), cex.names = 0.5)
opar = par(oma = c(0,0,0,0), mar = c(0,0,0,0), new = TRUE)
legend("topright", legend = rownames(counts4), fill=c("darkblue", "yellow", "green"))
```

Looking at the bar charts, I believe that the outcome most likely to be subjected to separation problems is $Y{MovedBetweenStates}$. If we look at the proportional bar charts, this outcome is the least frequented. This means that we have data sparsity for this outcome. I believe this means that in order for one or more of the covariates to perfectly predict this outcome, and for separation problems to arise, it has to "match" to fewer data points compared to any of the other two outcomes.

Tabulating covariates will reveal which one's are problematic. `hhincome_bi`, which is the binary negative income variable, is problematic because there are 0 respondents with negative income that migrated within the state of Kentucky. So the problem was actually situated in the $Y{MovedWithinState}$ outcome in this case. 

I removed this variable from the models presented below.  

\newpage

### Task C, D & E

```{r, echo=FALSE}
library(nnet)
```

```{r, echo=FALSE, include=FALSE}
m3 <-  multinom(migrate1 ~ race + hispan, data = Kentucky,  na.action = "na.exclude")
summary(m3)
```

```{r, echo=FALSE, include=FALSE}
m4 <-  multinom(migrate1 ~ race + hispan + log(hhincome) + citizen + metro.binary, data = Kentucky,  na.action = "na.exclude")
summary(m4)
```

```{r,echo=FALSE, results='asis', fig.asp=0.5}
stargazer(list(m3, m4),
          header=F, keep.stat = c("n", "ll"),
          title = "Multinomial logistic regression - Migration by Race and Hispanic origin",
          notes = c("Source: IPUMS Kentucky", "Observations: 50,000", "Log Likelihood: Model 1 -19765 | Model 2 -19456"),
          notes.align = "c",
          font.size = "footnotesize",
          covariate.labels = c("African American", "Native American", "East Asian", "Other Asian", "Other Race", "Mixed", "Hispanic", "Log Household Income", "Born Abroad Citizen", "Naturalized Citizen", "Not Citizen", "Binary Metropolitan resident"))
```

\newpage

Given my framing of migration as labor phenomena and the consequences from a perspective of race in Problem 1, I expect migration to be directed towards larger metropolitan areas, where a lot of the manufacturing (blue collar) jobs are located. Historically, migration is associated with this movement from countryside to urban areas. Here I include the same control variables as in Problem 1, except for the binary negative income variable. 

I also include a dummy variable for whether the respondent is a metropolitan resident or not.

The binary variable is based on the `countyicp` variable. The `countyicp` variable identifies in which county the household was enumerated during data collection. I will pool together households enumerated in the largest metropolitan areas of Kentucky and adjacent states. More specifically: Jefferson county (Louisville), Kenton county (Cincinnati-OH metropolitan area), Campbell county (Cincinnati-OH metropolitan area), Daviess county (Owensboro), Christian county (Clarksville-TN metropolitan area) and Fayette county (Lexington). I call this variable `metro.binary`.

I believe this variable give some indication how racial migration looks like along metropolitan and rural axes. From the perspective of this problem, I think this variable is interesting because it is possible that the effect of race could be mediated by whether they reside in a metropolitan area or not. 


\newpage

### Task F

```{r, fig.width=20, fig.height=10, echo=FALSE}
preds_m3 <- plot(allEffects(m3),
                 lines = list(multiline = T),
                 confint = list(style="auto"))
```
```{r, fig.width=30, fig.height=20, echo=FALSE}
preds_m4 <- plot(allEffects(m4),
                 lines = list(multiline = T),
                 confint = list(style="auto"))
```



\newpage

### Task G

```{r, echo=FALSE, include=FALSE}
(lrtest(m3,m4))
```


```{r, echo=FALSE}
c <- exp(coef(m3))
c <- t(c)
knitr::kable((c), digits=3, col.names=c("Moved Within State", "Moved Between State"), caption = "Odds ratios - model 3") %>% kable_styling(font_size = 10, full_width = F, position = "left")
```


```{r, echo=FALSE}
d <- exp(coef(m4))
d <- t(d)
knitr::kable((d),digits=3, col.names= c("Moved Within State", "Moved Between State"), caption = "Odds ratios - model 4") %>% kable_styling(font_size = 10, full_width = F, position = "left")
```

I interpret estimates as odds ratios. Odds ratios are displayed in tables 5 and 6. 
Our reference category is white respondents who did not change residence, i.e stayed in same house. 

First I look at which estimates are significant. As stated in Task A, I expect no change in significance across racial groups that had insignificant estimates in Problem 1. This assumption holds. The estimates for Native American and Other Race remain insignificant across the outcomes in both models. 

The estimate for African American is highly significant in our first-order relationship model for the outcome $Y{MovedWithinState}$. Odds-ratios for this estimate (seen in Table 3) reveal that being African American increases the likelihood of moving within the state of Kentucky by .553, compared to the reference category. The estimate in the first model for the outcome $Y{MovedBetweenState}$, is borderline significant with a p-value of 0.1. Odds-ratios show that the likelihood of moving between states is increased by .282 compared to the reference category.

In the second model that includes extra controls, the estimate for both outcomes are highly significant for African American respondents. Odds-ratios show that their likelihood for moving within the state and moving between state is .348 and .253 higher respectively, compared to the reference category. 

Estimates for Hispanic are also significant for both outcomes across both models. In regards to migrating within Kentucky, hispanic respondents have a .604 higher likelihood then the reference category in the first-order relationship model and a .408 higher likelihood in the extended model. In regards migrating across state borders, hispanic respondents have a .408 higher likelihood then the reference category in the first-order relationship model and a 2.047 higher likelihood in the extended model. 

Connecting back to my hypothesis, I said that African American and Hispanic respondents should be more likely to move within Kentucky than cross-state borders over both models. This is true for African American but not for Hispanic respondents. 

In regards to whites (intercept), my results are partially disconfirmed. whites are less likely to move across states than to move within the state which disconfirm my hypothesis. However, the estimates are negative and statistically significant in relation to my reference category which is in line with my expectations.

The estimates for East Asian in our first-order relationship model has a significance level of 0.05 at both outcomes. They have a .736 and 1.941 higher likelihood of moving within the state and moving between state respectively compared to the reference category. In the second model, the estimate for moving within Kentucky is turned insignificant. The estimate for moving between states remain significant and the likelihood increases. So when controls are included it become more likely for East Asian respondents in Kentucky to move cross state borders compared to the reference category.

For Other Asian, we have insignificant estimates for the $Y{MovedWithinState}$ outcome across both models. However, for the $Y{MovedBetweenState}$ outcome estimates are highly significant and return odds-ratio which show that for every white respondent that did not migrate, there are, statistically, ~4.4 Kentuckians from this race category moving to another state. 

The Mixed category has significant estimates for both outcomes across both models. For $Y{MovedWithinState}$ odds-ratios are 1.903 and 1.803. This indicate that the likelihood to migrate to somewhere within Kentucky are .903 higher compared to the reference category in the first-order relationship model and .803 higher in the model which includes extra controls.For the $Y{MovedBetweenStates}$ outcome, odds-ratios are ~2.7 and ~2.8. So for every respondent belonging to the reference category, we have 2.7 (first-order model) and 2.8 (extended model) respondents belonging to this racial category moving to another state. 

Results for East Asian, Other Asian and Mixed racial category respondents disconfirm my hypothesis. In regards to East Asian, the results are disconfirmed since $Y{MovedBetweenState}$ retain significance in the full model. In regards to Other Asian and Mixed, the hypothesis is disconfirmed since results show positive and significant estimates for both outcomes over both models. 

In the full model, that include additional covariates, we see that the estimates for certain focal independent variables that are statistically significant in regards to the outcome $Y{MovedWithinState}$ diminish. More specifically, they diminish for African American, Mixed and Hispanic. This suggests partial mediation. However, the estimate for Whites actually increase which is not what you would expect since inclusion of covariates more often than not reduce nested coefficients. A conclusion near at hand is that the covariates mediates the effect of certain racial groups but not others in regards to this outcome. 

For the $Y{MovedBetweenState}$ outcome, we see that this opposite trend of what we would expect under conditions of mediation continues. Statistically significant estimates for focal independent variables actually rise compared to the first-order relationship model. More specifically, they rise for African American, East Asian, Other Asian, Mixed, Hispanic and Whites. So when covariates are added they restrict the likelihoods for most racial groups in regards to one outcome (intra-Kentucky migration) in relation to the reference category, but expands them for the other outcome (inter-Kentucky migration). 

Conducting a Likelihood ratio test shows that the full model is more useful than the reduced model.

\newpage

## Problem 3

### Task A

```{r, echo=FALSE}
library(gtools)
```

```{r, echo=FALSE, include=FALSE}
States <- readRDS("States.rds")

Kentucky$medianHHincome <- ifelse(Kentucky$hhincome < median(Kentucky$hhincome), 0,1)
Kentucky$quantHHincome <- quantcut(Kentucky$hhincome)

mlog.data <- Kentucky[c("migrate1","race","hispan","medianHHincome","citizen", "serial", "statefip", "year","quantHHincome")] %>% mutate(id=paste0(year,serial))

mlog.data <- mlog.data[which(mlog.data$migrate1 == "Moved Between State"),names(mlog.data) %in% c("race","hispan","medianHHincome", "citizen", "statefip", "id", "migrate1", "quantHHincome")]

mlog.data <- mlog.data %>% full_join(States, by = character())

mlog.data <- mlog.data[c("migrate1","race","hispan","medianHHincome","citizen", "statefip.x","statefip.y","id",
"FreezingMonths","HotMonths","quantHHincome")]


try(na.fail(mlog.data))
mlog.data <- na.omit(mlog.data)
try(na.fail(mlog.data))

mlog.data$chid <- ifelse(mlog.data$statefip.x == mlog.data$statefip.y, 1, 0)
```

Connecting to my initial tangent regarding "Grapes of Wrath", the main characters are not only in pursuit of better economic conditions. They also talk throughout the book about quality of life improvements relatable to the climate that the move to California will bring about. Enabling them to eat fresh oranges from the trees etc. So when thinking about cross state migration, we should not underestimate the role quality of life factors as they relate to climate conditions play. (Frey & Liaw, 2005) 

Based on this, I think that cross state migration will largely be directed towards Sun Belt states such as Florida, Texas and southern California. So incorporating climate factors such as `FreezingMonths` and `HotMonths` as alternative specific variables will be very important further on. I believe cold weather, in general, acts as a push-factor and hot weather as a pull-factor. So overall hot weather will yield positive and significant estimates when interacted with race and hispanic origin. Conversely, freezing weather will result in negative and significant estimates.

However, I think that these quality of life factors will vary in effect conditioned by the general economic prospect of each racial category. So respondents from more well-off groups, whites, will have the most positive estimates when interacted with hot weather. Conversely, they should have the most negative estimates for freezing weather.

So for respondents that come from less-well of racial groups such as African American and Hispanic, the climate of the state their moving to will matter less because I believe the primary motifs of migrating cross-state borders still revolve around economic opportunities for these people. 

__Null Hypothesis 1__: Climate attributes of the state do not interact differently with different racial categories.

__Alt Hypothesis 1__: Climate attributes will interact differently with racial categories so that larger and significant estimates is returned in regards to Hot months for more well-off groups (whites). Conversely, Freezing months will return smaller estimates for whites compared to other groups.


```{r, echo=FALSE, warning=FALSE, include=FALSE}
library(survival)
```

```{r, echo=FALSE, include=FALSE}
m5 <- clogit(chid ~ HotMonths:race + FreezingMonths:race + HotMonths:hispan + FreezingMonths:hispan + strata(id), data=mlog.data, na.action = "na.exclude")
summary(m5)
```

```{r, echo=FALSE, include=FALSE}
m6 <- clogit(chid ~ HotMonths:race + FreezingMonths:race + HotMonths:hispan + FreezingMonths:hispan + medianHHincome:HotMonths + citizen:HotMonths + quantHHincome:HotMonths + medianHHincome:FreezingMonths + citizen:FreezingMonths + quantHHincome:FreezingMonths + strata(id) ,data=mlog.data, na.action="na.exclude")
summary(m6)
```

```{r, echo=FALSE, results='asis'}
stargazer(list(m5, m6),
          header=F, keep.stat = c("n","ll"),
          title = "Multinomial logistic regression - Migration to other state by Race and Hispanic origin",
          notes = c("Source: IPUMS Kentucky"),
          single.row = TRUE,
          font.size = "footnotesize",
          covariate.labels = c("HotMonths:White", "HotMonths:African American", "HotMonths:Native American", "HotMonths:East Asian", "HotMonths:Other Asian", "HotMonths:Other Race", "HotMonths:Mixed", "FreezingMonths:White", "FreezingMonths:African American", "FreezingMonths:Native American", "FreezingMonths:East Asian", "FreezingMonths:Other Asian", "FreezingMonths:Other Race", "FreezingMonths: Mixed", "HotMonths:Hispan", "FreezingMonths:Hispan","HotMonths:Household Inc. Median Binary", "HotMonths:Born Abroad Citizen", "HotMonths:Naturalized Citizen", "HotMonths:Not Citizen", "HotMonths:quantHHincome(2nd-quant)", "HotMonths:quantHHincome(3rd-quant)", "HotMonths:quantHHincome(4th-quant)", "FreezingMonths:Household Inc. Median Binary", "FreezingMonths:Born Abroad Citizen", "FreezingMonths:Naturalized Citizen", "FreezingMonths:Not Citizen", "FreezingMonths:quantHHincome(2nd-quant)", "FreezingMonths:quantHHincome(3rd-quant)", "FreezingMonths:quantHHincome(4th-quant)"))
```



### Task C

I think, similarly to the last two problems and as I already to in task A, that a respondents economic conditions could act as a mediator here. So disparities in the `hhincome` variable, I believe, will make the state attributes of climate less powerful, i.e lower the estimates, for less-well of groups more than for more well-off groups (whites). More concretely, certain racial categories will not be as off-put and pulled by freezing and hot weather respectively. Climate does not matter to them as much as relocating to a place were the economic opportunities are better.

I do a median split and convert `hhincome` into a binary variable : `medianHHincome`. Doing this categorical splitting has some issues. For example, it does not make so much sense that a value just above the median is categorized the same as a values at the end, or different than values just below. I believe this method is also associated with a loss of power, so it will be harder to find actuall effects. This is why I also include a quantile splitted control: `quantHHincome`. 

Considering the `citizen` variable, being an immigrant or having experience of moved long-distances previously might make you, when considering the costs and benefits of migration, more likely to migrate to another state. 

\newpage

```{r, echo=FALSE, include=FALSE}
(lrtest(m5,m6))
```


```{r, echo=FALSE}
e <- summary(m5)
e <- data.frame(e$coefficients)

e <- e[which(e$Pr...z..<0.1),] 

row.names(e) <- c("White * HotMonths", "African American * HotMonths", "Mixed * HotMonths", "White * FreezingMonths", "African American * FreezingMonths", "Native American * FreezingMonths", "Mixed * FreezingMonths", "Hispanic * HotMonths", "Hispanic * FreezingMonths")

colnames(e) <- c("Coefficient", "Odds ratios", "Standard error", "Z-value", "P-value")


knitr::kable((e), digits=3, caption = "Significant estimates - Multinomial logistic regression model 5 ") %>% kable_styling(font_size = 10, full_width = F, position = "left")
```

```{r, echo=FALSE}
f <- summary(m6)
f <- data.frame(f$coefficients)

f <- f[which(f$Pr...z..<0.1),] 

row.names(f) <- c("White * HotMonths", "African American * HotMonths", "Mixed * HotMonths", "White * FreezingMonths", "African American * FreezingMonths", "Native American * FreezingMonths", "Mixed * FreezingMonths", "Hispanic * HotMonths", "Hispanic * FreezingMonths", "Born Abroad Citizen * HotMonths")

colnames(f) <- c("Coefficient", "Odds ratios", "Standard error", "Z-value", "P-value")

knitr::kable((f), digits=3, caption = "Significant estimates - Multinomial logistic regression model 6 ") %>% kable_styling(font_size = 10, full_width = F, position = "left")
```
\newpage

### Task D

Compared to the other racial groups that actually had significant interactions with `HotMonths`, we see that whites do have the largest estimates looking at table 8 and 9. This is in line with my hypothesis. The effect has a positive direction for every racial category with significant estimates, but most so for whites. What this tells us is that just 1 month of hot weather won't increase the odds to move there for whites (i.e push the odds-ratios estimate past 1), but if the state has 2 or more hot weather months then we will start to see greater odds of migration for this, and other, groups. More specifically, for every incremental increase in `HotMonths`, whites will likelihood of migration will increase more relative to other racial groups. This is true over both models, so both with and without control covariates interacting with the state climate attribute for hot weather.

In regards to cold weather, whites continue to have the largest estimates compared to other racial groups. So for every incremental increase of freezing months, the likelihood to migrate for whites will increase with ~.67 in the first model. What this tells us then, is that when a state exceeds 2 freezing months then we will start to see greater odds of whites moving there. Racial groups retain their relative position to each other in regards to estimate size over both models, so when controls are included whites are still on top of the likelihood chart. 

In general, the estimates shrink but retains their significance when comparing the reduced model to the full model. So we know that partial mediation is happening. However, only one of the control covariates are significant when interacted with the state climate attributes that im interested in in regards to my hypothesis. From this, I think what we can actually say is that citizenship and Kentuckian household income in terms of median positioning and quantile positions play a small part and that what we are seeing is actually an effect of race. Further on, we could remove these controls now once they have been checked in order to reach a more parsimonious model and add other controls that we have theoretical motivation to include.

Connecting my results to the hypothesis, we can see that climate attributes interact differently with racial categories. We have positive and significant estimates for whites in regards to amount of hot months that states have. However, the estimates for cold weather does not have the direction that I expected. The estimates are not insignificant for other racial groups than whites. This also disqualifies my hypothesis. Seeing as none of my control covariates return significant estimates, I think that the mechanism I outlined, which focused primarily on respondents and racial categories relative economic opportunities and assets, as disqualified. So the effect we are seeing, looking at these models, does actually seem to have to do with racial factors which are not mediated by underlying economic conditions or citizenship statuses. 

In this problem, the Likelihood ratio test produces a non-significant test statistic. So the full model does not seem to be a more useful model in this case. 




\newpage

__________________________________________________________________________

### Reference list

_Economy of Kentucky_, Encyclopaedia Britannica, 2021-04-03. <https://www.britannica.com/place/Kentucky/Economy>

Frey, William & Liaw, Kao-Lee. (2005). Migration within the United States: Role of Race-Ethnicity. Brookings-Wharton Papers on Urban Affairs. 2005. 207-262. 10.1353/urb.2006.0004. 

Gurak, D.T. & Kritz, M.M. 2000, "The Interstate Migration of U.S. Immigrants: Individual and Contextual Determinants", Social forces, vol. 78, no. 3, pp. 1017-1039.













